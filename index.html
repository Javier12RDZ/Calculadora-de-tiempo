<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Jornada Laboral</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .time-input::-webkit-calendar-picker-indicator {
            filter: invert(0.6);
        }
        .blinking-dot {
            animation: blink 1.5s infinite;
        }
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">
    <div class="w-full max-w-2xl mx-auto bg-white rounded-xl shadow-lg p-6 md:p-8">
        
        <header class="mb-8 text-center">
            <h1 class="text-3xl font-bold text-gray-800">Calculadora de Jornada Laboral</h1>
            <p class="text-gray-500 mt-2">Registra tus horas para calcular tu jornada de 9 horas.</p>
        </header>

        <main id="calculator-container">
            <!-- Sección de Entrada Principal -->
            <div class="bg-gray-50 p-4 rounded-lg mb-6">
                <label for="check-in" class="block text-lg font-semibold text-gray-700 mb-2">Hora de Entrada Principal</label>
                <input type="time" id="check-in" class="time-input bg-white w-full p-3 rounded-md border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
            </div>

            <!-- Sección de Pausas -->
            <div class="mb-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-lg font-semibold text-gray-700">Pausas / Salidas</h2>
                    <button id="add-break" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg transition duration-300 ease-in-out transform hover:scale-105 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                          <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" />
                        </svg>
                        Añadir Pausa
                    </button>
                </div>
                <div id="breaks-container" class="space-y-4">
                    <!-- Las pausas se añadirán aquí dinámicamente -->
                </div>
            </div>

            <!-- Sección de Resultados -->
            <div id="results-container" class="bg-blue-50 border-l-4 border-blue-500 p-6 rounded-lg space-y-4 text-gray-800">
                <div class="flex justify-between items-center">
                    <h2 class="text-xl font-bold">Resumen de tu Jornada</h2>
                    <div id="timer-status" class="flex items-center text-sm text-gray-500" style="display: none;">
                        <div class="w-2 h-2 bg-green-500 rounded-full mr-2 blinking-dot"></div>
                        <span>Calculando...</span>
                    </div>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 text-center pt-4">
                    <div class="bg-white p-4 rounded-lg shadow">
                        <p class="text-sm text-gray-500 mb-1">Tiempo Trabajado</p>
                        <p id="time-worked" class="text-2xl font-semibold">00:00:00</p>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow">
                        <p class="text-sm text-gray-500 mb-1">Tiempo en Pausas</p>
                        <p id="time-breaks" class="text-2xl font-semibold">00:00:00</p>
                    </div>
                     <div class="bg-white p-4 rounded-lg shadow">
                        <p class="text-sm text-gray-500 mb-1">Tiempo Restante</p>
                        <p id="time-remaining" class="text-2xl font-semibold">09:00:00</p>
                    </div>
                    <div class="bg-green-100 p-4 rounded-lg shadow border border-green-300">
                        <p class="text-sm text-green-700 font-medium mb-1">Hora de Salida Sugerida</p>
                        <p id="exit-time" class="text-2xl font-bold text-green-800">--:--</p>
                    </div>
                </div>
                 <p id="status-message" class="text-center text-gray-600 mt-4 h-5"></p>
            </div>
             <!-- Botón de Reinicio -->
            <div class="mt-8 text-center">
                <button id="reset-day" class="text-gray-500 hover:text-red-600 hover:bg-red-100 font-medium py-2 px-4 rounded-lg transition">
                    Reiniciar Día
                </button>
            </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // CONSTANTES Y VARIABLES GLOBALES
            const TOTAL_WORK_MS = 9 * 60 * 60 * 1000;
            const STANDARD_BREAK_MS = 30 * 60 * 1000;
            let timerInterval = null;

            // ELEMENTOS DEL DOM
            const checkInInput = document.getElementById('check-in');
            const addBreakButton = document.getElementById('add-break');
            const breaksContainer = document.getElementById('breaks-container');
            const calculatorContainer = document.getElementById('calculator-container');
            const resetDayButton = document.getElementById('reset-day');
            const timerStatusEl = document.getElementById('timer-status');

            // ELEMENTOS DE RESULTADOS
            const timeWorkedEl = document.getElementById('time-worked');
            const timeBreaksEl = document.getElementById('time-breaks');
            const timeRemainingEl = document.getElementById('time-remaining');
            const exitTimeEl = document.getElementById('exit-time');
            const statusMessageEl = document.getElementById('status-message');

            // --- MANEJADORES DE EVENTOS ---
            calculatorContainer.addEventListener('input', () => {
                if (checkInInput.value && !timerInterval) {
                    timerInterval = setInterval(calculateTimes, 1000);
                    timerStatusEl.style.display = 'flex';
                }
                calculateTimes();
            });

            addBreakButton.addEventListener('click', () => {
                addBreakEntry();
                calculateTimes();
            });

            resetDayButton.addEventListener('click', () => {
                checkInInput.value = '';
                breaksContainer.innerHTML = '';
                stopTimer();
                resetResults();
            });

            // --- LÓGICA DEL TEMPORIZADOR Y CÁLCULOS ---
            
            function stopTimer() {
                clearInterval(timerInterval);
                timerInterval = null;
                timerStatusEl.style.display = 'none';
            }

            function addBreakEntry() {
                const breakId = Date.now();
                const breakEntry = document.createElement('div');
                breakEntry.classList.add('p-4', 'rounded-lg', 'border', 'border-gray-200', 'grid', 'grid-cols-1', 'sm:grid-cols-3', 'gap-4', 'items-center', 'break-entry');
                breakEntry.id = `break-${breakId}`;

                breakEntry.innerHTML = `
                    <div class="col-span-1 sm:col-span-2 grid grid-cols-2 gap-4">
                         <div>
                            <label for="out-${breakId}" class="block text-sm font-medium text-gray-600">Salida</label>
                            <input type="time" id="out-${breakId}" class="time-input mt-1 w-full p-2 rounded-md border border-gray-300 focus:ring-indigo-500 focus:border-indigo-500">
                        </div>
                        <div>
                            <label for="in-${breakId}" class="block text-sm font-medium text-gray-600">Regreso</label>
                            <input type="time" id="in-${breakId}" class="time-input mt-1 w-full p-2 rounded-md border border-gray-300 focus:ring-indigo-500 focus:border-indigo-500">
                        </div>
                    </div>
                    <div class="text-right">
                         <button data-remove-id="${breakId}" class="remove-break-btn bg-red-100 text-red-600 hover:bg-red-200 p-2 rounded-full transition duration-300">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                              <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                            </svg>
                        </button>
                    </div>
                `;
                breaksContainer.appendChild(breakEntry);

                breakEntry.querySelector('.remove-break-btn').addEventListener('click', (e) => {
                    const idToRemove = e.currentTarget.getAttribute('data-remove-id');
                    document.getElementById(`break-${idToRemove}`).remove();
                    calculateTimes();
                });
            }

            function calculateTimes() {
                const checkInValue = checkInInput.value;
                if (!checkInValue) {
                    stopTimer();
                    resetResults();
                    return;
                }

                const checkInDate = parseTimeToDate(checkInValue);
                if (!checkInDate) return;

                const now = new Date();
                let totalWorkedMs = 0;
                let totalBreakMs = 0;
                let lastEventDate = checkInDate;
                let isCurrentlyOut = false;
                let statusMessage = '';

                const breakEntries = document.querySelectorAll('.break-entry');
                
                for (const entry of breakEntries) {
                    const timeInputs = entry.querySelectorAll('input[type="time"]');
                    if (timeInputs.length < 2) continue;
                    
                    const outValue = timeInputs[0].value;
                    const inValue = timeInputs[1].value;
                    
                    if (outValue) {
                        const outDate = parseTimeToDate(outValue);
                        if (!outDate || outDate < lastEventDate) {
                           statusMessage = 'Error: Una hora de salida es inválida.';
                           isCurrentlyOut = true;
                           break;
                        }

                        totalWorkedMs += outDate.getTime() - lastEventDate.getTime();
                        
                        if (inValue) {
                            const inDate = parseTimeToDate(inValue);
                             if (!inDate || inDate < outDate) {
                                statusMessage = 'Error: Una hora de regreso es anterior a su salida.';
                                isCurrentlyOut = true;
                                break;
                            }
                            totalBreakMs += inDate.getTime() - outDate.getTime();
                            lastEventDate = inDate;
                            isCurrentlyOut = false;
                        } else {
                            isCurrentlyOut = true;
                            statusMessage = 'Actualmente en pausa. Introduce la hora de regreso para continuar.';
                            break; 
                        }
                    }
                }

                if (!isCurrentlyOut) {
                    totalWorkedMs += now.getTime() - lastEventDate.getTime();
                }

                const remainingWorkMs = Math.max(0, TOTAL_WORK_MS - totalWorkedMs);
                
                // CÁLCULO DE HORA DE SALIDA ESTÁTICA
                // Se calcula la hora de salida añadiendo 9.5 horas a la entrada,
                // más cualquier pausa que exceda los 30 minutos estándar.
                const extraBreakMs = Math.max(0, totalBreakMs - STANDARD_BREAK_MS);
                const exitTimeMillis = checkInDate.getTime() + TOTAL_WORK_MS + STANDARD_BREAK_MS + extraBreakMs;
                const exitDate = new Date(exitTimeMillis);

                updateResults(totalWorkedMs, totalBreakMs, remainingWorkMs, exitDate, isCurrentlyOut, statusMessage);
            }
            
            function updateResults(workedMs, breakMs, remainingMs, exitDate, isOut, status) {
                timeWorkedEl.textContent = formatMsToHMS(workedMs);
                timeBreaksEl.textContent = formatMsToHMS(breakMs);
                timeRemainingEl.textContent = formatMsToHMS(remainingMs);
                
                statusMessageEl.textContent = status;
                statusMessageEl.classList.toggle('text-red-500', status.toLowerCase().includes('error'));
                
                if (isOut) {
                    exitTimeEl.textContent = '--:--';
                } else {
                    exitTimeEl.textContent = formatDateToHHMM(exitDate);
                }

                if (remainingMs <= 0 && workedMs > 0) {
                     timeRemainingEl.textContent = 'Completado';
                     stopTimer();
                }
            }
            
            function resetResults() {
                timeWorkedEl.textContent = '00:00:00';
                timeBreaksEl.textContent = '00:00:00';
                timeRemainingEl.textContent = '09:00:00';
                exitTimeEl.textContent = '--:--';
                statusMessageEl.textContent = '';
            }

            // --- FUNCIONES AUXILIARES ---
function parseTimeToDate(timeString) {
    if (!timeString) return null;
    const [hours, minutes] = timeString.split(':');
    return new Date(new Date().setHours(Number(hours), Number(minutes), 0, 0));            }

            function formatMsToHMS(ms) {
                if (ms < 0) ms = 0;
                const totalSeconds = Math.floor(ms / 1000);
                const hours = Math.floor(totalSeconds / 3600);
                const minutes = Math.floor((totalSeconds % 3600) / 60);
                const seconds = totalSeconds % 60;
                return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            }

            function formatDateToHHMM(date) {
                if (!date) return '--:--';
                const hours = String(date.getHours()).padStart(2, '0');
                const minutes = String(date.getMinutes()).padStart(2, '0');
                return `${hours}:${minutes}`;
            }

        });
    </script>
</body>
</html>

